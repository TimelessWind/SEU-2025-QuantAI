# 量化交易选股系统架构

## 系统架构概览

```
┌─────────────────────────────────────────────────────────────┐
│                    用户界面层 (Frontend)                      │
├─────────────────────────────────────────────────────────────┤
│  Vue 3 + Element Plus + Pinia + Axios                      │
│  ┌─────────────┬─────────────┬─────────────┬─────────────┐  │
│  │  登录/注册   │    首页     │  股票筛选    │  策略管理    │  │
│  │   页面      │    页面     │    页面     │    页面     │  │
│  └─────────────┴─────────────┴─────────────┴─────────────┘  │
└─────────────────────────────────────────────────────────────┘
                                │
                                │ HTTP/API
                                ▼
┌─────────────────────────────────────────────────────────────┐
│                    API网关层 (Backend)                       │
├─────────────────────────────────────────────────────────────┤
│  Flask + JWT + CORS + PyMySQL                              │
│  ┌─────────────┬─────────────┬─────────────┬─────────────┐  │
│  │  用户认证    │  股票筛选    │  策略管理    │  回测分析    │  │
│  │   模块      │    模块     │    模块     │    模块     │  │
│  └─────────────┴─────────────┴─────────────┴─────────────┘  │
└─────────────────────────────────────────────────────────────┘
                                │
                                │ SQL
                                ▼
┌─────────────────────────────────────────────────────────────┐
│                    数据存储层 (Database)                      │
├─────────────────────────────────────────────────────────────┤
│  MySQL 8.0                                                  │
│  ┌─────────────┬─────────────┬─────────────┬─────────────┐  │
│  │   用户表    │  股票基础表  │  市场数据表  │  财务数据表  │  │
│  │   User     │ StockBasic │StockMarket │StockValuation│  │
│  └─────────────┴─────────────┴─────────────┴─────────────┘  │
│  ┌─────────────┬─────────────┬─────────────┬─────────────┐  │
│  │  策略表     │  回测报告表  │  交易信号表  │  系统日志表  │  │
│  │  Strategy  │BacktestReport│TradingSignal│ SystemLog  │  │
│  └─────────────┴─────────────┴─────────────┴─────────────┘  │
└─────────────────────────────────────────────────────────────┘
                                │
                                │ API调用
                                ▼
┌─────────────────────────────────────────────────────────────┐
│                    数据源层 (External APIs)                   │
├─────────────────────────────────────────────────────────────┤
│  Tushare API                                                │
│  ┌─────────────┬─────────────┬─────────────┬─────────────┐  │
│  │  股票行情    │  财务数据    │  指数数据    │  交易日历    │  │
│  │  Daily     │Financial   │Index       │TradeCal     │  │
│  └─────────────┴─────────────┴─────────────┴─────────────┘  │
└─────────────────────────────────────────────────────────────┘
```

## 技术栈详情

### 前端技术栈
- **Vue 3**: 渐进式JavaScript框架，使用Composition API
- **Element Plus**: 基于Vue 3的组件库，提供丰富的UI组件
- **Pinia**: Vue 3的状态管理库
- **Vite**: 快速的前端构建工具
- **Axios**: HTTP客户端，用于API调用
- **Vue Router**: 前端路由管理

### 后端技术栈
- **Flask**: 轻量级Python Web框架
- **PyMySQL**: MySQL数据库连接器
- **JWT**: JSON Web Token身份验证
- **Flask-CORS**: 跨域资源共享支持
- **Python-dotenv**: 环境变量管理

### 数据库设计
- **MySQL 8.0**: 关系型数据库
- **UTF8MB4**: 字符集支持，兼容emoji
- **索引优化**: 针对查询性能优化
- **视图支持**: LatestStockPrice视图用于快速查询最新价格

### 外部数据源
- **Tushare**: 专业的金融数据服务
- **实时数据**: 股票行情、财务数据、指数数据
- **历史数据**: 支持历史回测分析

## 核心功能模块

### 1. 用户认证模块
```
用户注册 → 密码哈希 → 数据库存储
用户登录 → 密码验证 → JWT Token生成 → 前端存储
API请求 → Token验证 → 权限检查 → 业务逻辑
```

### 2. 股票筛选模块
```
筛选条件 → 前端验证 → API请求 → SQL查询构建
数据库查询 → 结果格式化 → 前端展示 → 导出功能
```

### 3. 策略管理模块
```
策略创建 → 条件配置 → 数据库存储 → 策略列表
策略编辑 → 条件更新 → 版本控制 → 回测准备
```

### 4. 回测分析模块
```
策略选择 → 参数配置 → 历史数据查询 → 策略执行
收益计算 → 风险指标 → 结果可视化 → 报告生成
```

## 数据流程

### 数据采集流程
```
Tushare API → 数据获取脚本 → 数据清洗 → 数据库存储
定时任务 → 增量更新 → 数据验证 → 完整性检查
```

### 用户操作流程
```
用户登录 → 权限验证 → 功能选择 → 数据查询
结果展示 → 用户交互 → 数据导出 → 操作记录
```

## 安全机制

### 前端安全
- **XSS防护**: Element Plus组件自带XSS防护
- **CSRF防护**: 使用JWT Token防止CSRF攻击
- **路由守卫**: 基于权限的路由访问控制

### 后端安全
- **密码加密**: SHA256哈希加密存储
- **JWT认证**: 无状态的Token认证机制
- **SQL注入防护**: 参数化查询防止SQL注入
- **跨域控制**: CORS配置限制跨域访问

### 数据库安全
- **连接加密**: 数据库连接使用加密
- **权限控制**: 最小权限原则
- **数据备份**: 定期数据备份策略

## 性能优化

### 前端优化
- **组件懒加载**: 路由级别的代码分割
- **虚拟滚动**: 大数据列表的性能优化
- **缓存策略**: 合理的API数据缓存

### 后端优化
- **数据库索引**: 关键字段建立索引
- **查询优化**: 复杂查询的性能优化
- **连接池**: 数据库连接池管理

### 数据库优化
- **分区表**: 大数据量的表分区策略
- **读写分离**: 主从数据库架构
- **缓存层**: Redis缓存热点数据

## 部署架构

### 开发环境
```
Frontend (localhost:3000) → Backend (localhost:8000) → MySQL (localhost:3306)
```

### 生产环境建议
```
Nginx → Frontend (静态文件) → Backend (Gunicorn) → MySQL (主从)
       ↓
    Redis (缓存) → Tushare API (数据源)
```

## 扩展性设计

### 水平扩展
- **前端**: CDN分发，多实例部署
- **后端**: 负载均衡，微服务架构
- **数据库**: 读写分离，分库分表

### 功能扩展
- **插件系统**: 支持第三方策略插件
- **API开放**: 提供开放API接口
- **数据源扩展**: 支持更多数据源接入

## 监控与日志

### 系统监控
- **性能监控**: 响应时间、吞吐量监控
- **错误监控**: 异常捕获和告警
- **资源监控**: CPU、内存、磁盘使用率

### 业务监控
- **用户行为**: 用户操作路径分析
- **数据质量**: 数据准确性和完整性监控
- **策略表现**: 策略收益和风险监控

### 日志管理
- **访问日志**: HTTP请求日志记录
- **错误日志**: 异常和错误信息记录
- **业务日志**: 关键业务操作记录





