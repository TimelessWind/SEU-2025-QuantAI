import{r as d,p as A,c as o,D as H,o as f,d as J,e as i,f as t,w as l,q as V,E as c,h as K,i as u,G as P,m as b,t as v,n as Q,B as W,y as X}from"./index-105ea695.js";import{_ as Y}from"./_plugin-vue_export-helper-c27b6911.js";const Z={class:"user-management"},ee={class:"user-content"},te={class:"card-header"},ae={class:"header-actions"},le={__name:"UserManagement",setup(se){const h=d([]),g=d(!1),y=d([]),k=d(!1),p=d(!1),n=d({user_id:"",account:"",currentStatus:"",newStatus:""}),w=async()=>{g.value=!0;try{const a=await V.get("/admin/users");h.value=a.data.users}catch(a){c.error("获取用户列表失败"),console.error("获取用户列表失败:",a)}finally{g.value=!1}},B=()=>{w()},D=async a=>{try{await W.confirm(`确定要解锁用户 "${a.account}" 吗？`,"确认解锁",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),y.value.push(a.user_id);try{await V.post(`/admin/users/${a.user_id}/unlock`),c.success("用户解锁成功"),await w()}catch{c.error("解锁失败")}finally{const e=y.value.indexOf(a.user_id);e>-1&&y.value.splice(e,1)}}catch{}},M=a=>{n.value={user_id:a.user_id,account:a.account,currentStatus:a.status,newStatus:a.status},p.value=!0},$=async()=>{if(n.value.newStatus===n.value.currentStatus){c.warning("状态未发生变化");return}k.value=!0;try{await V.put(`/admin/users/${n.value.user_id}/status`,{status:n.value.newStatus}),c.success("用户状态更新成功"),p.value=!1,await w()}catch{c.error("更新用户状态失败")}finally{k.value=!1}},N=a=>({admin:"danger",analyst:"warning",viewer:"info"})[a]||"info",E=a=>({admin:"管理员",analyst:"分析师",viewer:"普通用户"})[a]||a,U=a=>({active:"success",inactive:"warning",locked:"danger"})[a]||"info",C=a=>({active:"正常",inactive:"禁用",locked:"锁定"})[a]||a,T=a=>a?new Date(a).toLocaleString("zh-CN"):"-";return A(()=>{w()}),(a,e)=>{const z=o("el-icon"),_=o("el-button"),r=o("el-table-column"),m=o("el-tag"),q=o("el-table"),R=o("el-card"),F=o("el-input"),x=o("el-form-item"),S=o("el-option"),G=o("el-select"),I=o("el-form"),L=o("el-dialog"),O=H("loading");return f(),J("div",Z,[e[12]||(e[12]=i("div",{class:"page-header"},[i("h1",{class:"page-title"},"用户管理"),i("p",{class:"page-subtitle"},"管理系统用户和权限")],-1)),i("div",ee,[t(R,{class:"user-card"},{header:l(()=>[i("div",te,[e[5]||(e[5]=i("h3",{class:"card-title"},"用户列表",-1)),i("div",ae,[t(_,{onClick:B,loading:g.value},{default:l(()=>[t(z,null,{default:l(()=>[t(K(X))]),_:1}),e[4]||(e[4]=u(" 刷新 ",-1))]),_:1},8,["loading"])])])]),default:l(()=>[P((f(),b(q,{data:h.value,style:{width:"100%"}},{default:l(()=>[t(r,{prop:"account",label:"账号",width:"120"}),t(r,{prop:"role",label:"角色",width:"100"},{default:l(({row:s})=>[t(m,{type:N(s.role)},{default:l(()=>[u(v(E(s.role)),1)]),_:2},1032,["type"])]),_:1}),t(r,{prop:"status",label:"状态",width:"100"},{default:l(({row:s})=>[t(m,{type:U(s.status)},{default:l(()=>[u(v(C(s.status)),1)]),_:2},1032,["type"])]),_:1}),t(r,{prop:"email",label:"邮箱",width:"200"}),t(r,{prop:"phone",label:"手机",width:"120"}),t(r,{prop:"login_attempts",label:"失败次数",width:"100"}),t(r,{prop:"is_locked",label:"锁定状态",width:"100"},{default:l(({row:s})=>[s.is_locked?(f(),b(m,{key:0,type:"danger"},{default:l(()=>[...e[6]||(e[6]=[u("已锁定",-1)])]),_:1})):(f(),b(m,{key:1,type:"success"},{default:l(()=>[...e[7]||(e[7]=[u("正常",-1)])]),_:1}))]),_:1}),t(r,{prop:"create_time",label:"创建时间",width:"180"},{default:l(({row:s})=>[u(v(T(s.create_time)),1)]),_:1}),t(r,{prop:"last_login_time",label:"最后登录",width:"180"},{default:l(({row:s})=>[u(v(T(s.last_login_time)),1)]),_:1}),t(r,{label:"操作",width:"200",fixed:"right"},{default:l(({row:s})=>[s.is_locked?(f(),b(_,{key:0,type:"success",size:"small",onClick:j=>D(s),loading:y.value.includes(s.user_id)},{default:l(()=>[...e[8]||(e[8]=[u(" 解锁 ",-1)])]),_:1},8,["onClick","loading"])):Q("",!0),t(_,{type:"primary",size:"small",onClick:j=>M(s)},{default:l(()=>[...e[9]||(e[9]=[u(" 修改状态 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[O,g.value]])]),_:1})]),t(L,{modelValue:p.value,"onUpdate:modelValue":e[3]||(e[3]=s=>p.value=s),title:"修改用户状态",width:"400px"},{footer:l(()=>[t(_,{onClick:e[2]||(e[2]=s=>p.value=!1)},{default:l(()=>[...e[10]||(e[10]=[u("取消",-1)])]),_:1}),t(_,{type:"primary",onClick:$,loading:k.value},{default:l(()=>[...e[11]||(e[11]=[u(" 确定 ",-1)])]),_:1},8,["loading"])]),default:l(()=>[t(I,{model:n.value,"label-width":"80px"},{default:l(()=>[t(x,{label:"用户账号"},{default:l(()=>[t(F,{modelValue:n.value.account,"onUpdate:modelValue":e[0]||(e[0]=s=>n.value.account=s),disabled:""},null,8,["modelValue"])]),_:1}),t(x,{label:"当前状态"},{default:l(()=>[t(m,{type:U(n.value.currentStatus)},{default:l(()=>[u(v(C(n.value.currentStatus)),1)]),_:1},8,["type"])]),_:1}),t(x,{label:"新状态",required:""},{default:l(()=>[t(G,{modelValue:n.value.newStatus,"onUpdate:modelValue":e[1]||(e[1]=s=>n.value.newStatus=s),placeholder:"请选择状态"},{default:l(()=>[t(S,{label:"正常",value:"active"}),t(S,{label:"禁用",value:"inactive"}),t(S,{label:"锁定",value:"locked"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},ue=Y(le,[["__scopeId","data-v-1f35c58b"]]);export{ue as default};
