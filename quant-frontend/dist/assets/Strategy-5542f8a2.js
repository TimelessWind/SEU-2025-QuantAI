import{r as k,a as Y,b as Z,p as ee,q as C,E as y,c as s,o as p,d as B,e as m,f as e,w as a,h as F,m as x,i as d,t as T,n as z,F as te,s as le,A as ae}from"./index-bc6ca494.js";import{_ as oe}from"./_plugin-vue_export-helper-c27b6911.js";const ne={class:"strategy-container"},se={class:"strategy-content"},ie={class:"card-header"},re={class:"condition-list"},de={__name:"Strategy",setup(ue){const _=k(!1),f=k(!1),S=k(!1),g=k(),I=Y(),{canCreateStrategy:h}=I,u=k([]),l=Z({id:"",name:"",description:"",conditions:[]}),N={name:[{required:!0,message:"请输入策略名称",trigger:"blur"}],description:[{required:!0,message:"请输入策略描述",trigger:"blur"}]},P=()=>{f.value=!1,_.value=!0,U()},q=n=>{f.value=!0,_.value=!0,l.id=n.id,l.name=n.name,l.description=n.description,l.conditions=n.conditions||[]},M=n=>{y.info(`开始回测策略: ${n.name}`)},R=async n=>{try{await ae.confirm(`确定要删除策略 "${n.name}" 吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await C.delete(`/strategies/${n.id}`);const t=u.value.findIndex(c=>c.id===n.id);t>-1&&u.value.splice(t,1),y.success("策略删除成功")}catch(t){t!=="cancel"&&y.error("删除失败，请重试")}},L=()=>{l.conditions.push({indicator:"",operator:"",value:null})},A=n=>{l.conditions.splice(n,1)},U=()=>{l.id="",l.name="",l.description="",l.conditions=[],g.value&&g.value.resetFields()},j=async()=>{g.value&&await g.value.validate(async n=>{if(n){S.value=!0;try{if(f.value){await C.put(`/strategies/${l.id}`,{name:l.name,description:l.description,conditions:l.conditions});const t=u.value.findIndex(c=>c.id===l.id);t>-1&&(u.value[t]={...u.value[t],name:l.name,description:l.description})}else{const t=await C.post("/strategies",{name:l.name,description:l.description,conditions:l.conditions});u.value.unshift({id:t.data.strategyId,name:l.name,type:"custom",description:l.description,createTime:new Date().toLocaleString()})}y.success(f.value?"策略更新成功":"策略创建成功"),_.value=!1,U()}catch{y.error("保存失败，请重试")}finally{S.value=!1}}})};return ee(async()=>{try{const n=await C.get("/strategies");u.value=n.data.strategies}catch(n){console.error("加载策略列表失败:",n),y.error("加载策略列表失败")}}),(n,t)=>{const c=s("Plus"),w=s("el-icon"),i=s("el-button"),G=s("el-tooltip"),b=s("el-table-column"),H=s("el-tag"),J=s("el-table"),K=s("el-card"),E=s("el-input"),$=s("el-form-item"),r=s("el-option"),D=s("el-select"),O=s("el-input-number"),Q=s("Delete"),W=s("el-form"),X=s("el-dialog");return p(),B("div",ne,[t[12]||(t[12]=m("div",{class:"page-header"},[m("h1",{class:"page-title"},"策略管理"),m("p",{class:"page-subtitle"},"创建和管理量化投资策略")],-1)),m("div",se,[e(K,{class:"strategy-card"},{header:a(()=>[m("div",ie,[t[6]||(t[6]=m("h3",{class:"card-title"},"投资策略",-1)),F(h)?(p(),x(i,{key:0,type:"primary",onClick:P},{default:a(()=>[e(w,null,{default:a(()=>[e(c)]),_:1}),t[4]||(t[4]=d(" 创建策略 ",-1))]),_:1})):(p(),x(G,{key:1,content:"只有分析师和管理员可以创建策略",placement:"top"},{default:a(()=>[e(i,{type:"primary",disabled:""},{default:a(()=>[e(w,null,{default:a(()=>[e(c)]),_:1}),t[5]||(t[5]=d(" 创建策略 ",-1))]),_:1})]),_:1}))])]),default:a(()=>[e(J,{data:u.value,style:{width:"100%"}},{default:a(()=>[e(b,{prop:"name",label:"策略名称",width:"200"}),e(b,{prop:"type",label:"类型",width:"120"},{default:a(({row:o})=>[e(H,{type:o.type==="builtin"?"success":"primary"},{default:a(()=>[d(T(o.type==="builtin"?"内置策略":"自定义策略"),1)]),_:2},1032,["type"])]),_:1}),e(b,{prop:"description",label:"策略描述"}),e(b,{prop:"createTime",label:"创建时间",width:"180"}),e(b,{label:"操作",width:"200"},{default:a(({row:o})=>[F(h)?(p(),x(i,{key:0,type:"primary",size:"small",onClick:V=>q(o)},{default:a(()=>[...t[7]||(t[7]=[d(" 编辑 ",-1)])]),_:1},8,["onClick"])):z("",!0),e(i,{type:"success",size:"small",onClick:V=>M(o)},{default:a(()=>[...t[8]||(t[8]=[d(" 回测 ",-1)])]),_:1},8,["onClick"]),F(h)&&o.type!=="builtin"?(p(),x(i,{key:1,type:"danger",size:"small",onClick:V=>R(o)},{default:a(()=>[...t[9]||(t[9]=[d(" 删除 ",-1)])]),_:1},8,["onClick"])):z("",!0)]),_:1})]),_:1},8,["data"])]),_:1}),e(X,{modelValue:_.value,"onUpdate:modelValue":t[3]||(t[3]=o=>_.value=o),title:f.value?"编辑策略":"创建策略",width:"800px",onClose:U},{footer:a(()=>[e(i,{onClick:t[2]||(t[2]=o=>_.value=!1)},{default:a(()=>[...t[11]||(t[11]=[d("取消",-1)])]),_:1}),e(i,{type:"primary",onClick:j,loading:S.value},{default:a(()=>[d(T(f.value?"更新":"创建"),1)]),_:1},8,["loading"])]),default:a(()=>[e(W,{model:l,rules:N,ref_key:"strategyFormRef",ref:g,"label-width":"120px"},{default:a(()=>[e($,{label:"策略名称",prop:"name"},{default:a(()=>[e(E,{modelValue:l.name,"onUpdate:modelValue":t[0]||(t[0]=o=>l.name=o),placeholder:"请输入策略名称"},null,8,["modelValue"])]),_:1}),e($,{label:"策略描述",prop:"description"},{default:a(()=>[e(E,{modelValue:l.description,"onUpdate:modelValue":t[1]||(t[1]=o=>l.description=o),type:"textarea",rows:3,placeholder:"请输入策略描述"},null,8,["modelValue"])]),_:1}),e($,{label:"策略条件"},{default:a(()=>[m("div",re,[(p(!0),B(te,null,le(l.conditions,(o,V)=>(p(),B("div",{key:V,class:"condition-item"},[e(D,{modelValue:o.indicator,"onUpdate:modelValue":v=>o.indicator=v,placeholder:"选择指标",style:{width:"150px"}},{default:a(()=>[e(r,{label:"PE市盈率",value:"pe"}),e(r,{label:"PB市净率",value:"pb"}),e(r,{label:"市值",value:"market_cap"}),e(r,{label:"成交量",value:"volume"}),e(r,{label:"涨跌幅",value:"change_percent"})]),_:1},8,["modelValue","onUpdate:modelValue"]),e(D,{modelValue:o.operator,"onUpdate:modelValue":v=>o.operator=v,placeholder:"条件",style:{width:"100px"}},{default:a(()=>[e(r,{label:"大于",value:">"}),e(r,{label:"小于",value:"<"}),e(r,{label:"等于",value:"="}),e(r,{label:"介于",value:"between"})]),_:1},8,["modelValue","onUpdate:modelValue"]),e(O,{modelValue:o.value,"onUpdate:modelValue":v=>o.value=v,precision:2,placeholder:"值",style:{width:"120px"}},null,8,["modelValue","onUpdate:modelValue"]),e(i,{type:"danger",size:"small",onClick:v=>A(V)},{default:a(()=>[e(w,null,{default:a(()=>[e(Q)]),_:1})]),_:1},8,["onClick"])]))),128)),e(i,{type:"dashed",onClick:L,style:{width:"100%"}},{default:a(()=>[e(w,null,{default:a(()=>[e(c)]),_:1}),t[10]||(t[10]=d(" 添加条件 ",-1))]),_:1})])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])])}}},me=oe(de,[["__scopeId","data-v-ac6cdfe5"]]);export{me as default};
