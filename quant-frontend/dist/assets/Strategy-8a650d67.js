import{r as b,a as Z,A as ee,b as te,p as le,q as k,E as p,c as s,o as m,d as B,e as _,f as t,w as l,h as x,m as h,i as d,t as R,n as T,F as ae,s as oe,B as ne}from"./index-105ea695.js";import{_ as se}from"./_plugin-vue_export-helper-c27b6911.js";const ie={class:"strategy-container"},re={class:"strategy-content"},de={class:"card-header"},ue={class:"condition-list"},ce={__name:"Strategy",setup(pe){const w=b(!1),V=b(!1),S=b(!1),y=b(),z=Z(),{canCreateStrategy:F,isAdmin:$}=ee(z),u=b([]),a=te({id:"",name:"",description:"",conditions:[]}),N={name:[{required:!0,message:"请输入策略名称",trigger:"blur"}],description:[{required:!0,message:"请输入策略描述",trigger:"blur"}]},P=()=>{window.open("/strategy_editor_frontend.html","_blank")},q=async n=>{if(!$.value){p.info("只有管理员可以编辑策略");return}try{const c=(await k.get(`/strategies/${n.id}`)).data;window.open(`/strategy_editor_frontend.html?strategy_id=${n.id}`,"_blank")}catch(e){console.error("加载策略详情失败:",e),p.error("加载策略详情失败，请重试")}},M=n=>{window.open(`/backtest?strategy_id=${n.id}&strategy_name=${encodeURIComponent(n.name)}`,"_blank")},A=async n=>{try{await ne.confirm(`确定要删除策略 "${n.name}" 吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await k.delete(`/strategies/${n.id}`);const e=u.value.findIndex(c=>c.id===n.id);e>-1&&u.value.splice(e,1),p.success("策略删除成功")}catch(e){e!=="cancel"&&p.error("删除失败，请重试")}},L=()=>{a.conditions.push({indicator:"",operator:"",value:null})},j=n=>{a.conditions.splice(n,1)},E=()=>{a.id="",a.name="",a.description="",a.conditions=[],y.value&&y.value.resetFields()},G=async()=>{y.value&&await y.value.validate(async n=>{if(n){S.value=!0;try{if(V.value){await k.put(`/strategies/${a.id}`,{name:a.name,description:a.description,conditions:a.conditions});const e=u.value.findIndex(c=>c.id===a.id);e>-1&&(u.value[e]={...u.value[e],name:a.name,description:a.description})}else{const e=await k.post("/strategies",{name:a.name,description:a.description,conditions:a.conditions});u.value.unshift({id:e.data.strategyId,name:a.name,type:"custom",description:a.description,createTime:new Date().toLocaleString()})}p.success(V.value?"策略更新成功":"策略创建成功"),w.value=!1,E()}catch{p.error("保存失败，请重试")}finally{S.value=!1}}})};return le(async()=>{try{const n=await k.get("/strategies");u.value=n.data.strategies}catch(n){console.error("加载策略列表失败:",n),p.error("加载策略列表失败")}}),(n,e)=>{const c=s("Plus"),C=s("el-icon"),i=s("el-button"),H=s("el-tooltip"),v=s("el-table-column"),J=s("el-tag"),K=s("el-table"),O=s("el-card"),D=s("el-input"),U=s("el-form-item"),r=s("el-option"),I=s("el-select"),Q=s("el-input-number"),W=s("Delete"),X=s("el-form"),Y=s("el-dialog");return m(),B("div",ie,[e[12]||(e[12]=_("div",{class:"page-header"},[_("h1",{class:"page-title"},"策略管理"),_("p",{class:"page-subtitle"},"创建和管理量化投资策略")],-1)),_("div",re,[t(O,{class:"strategy-card"},{header:l(()=>[_("div",de,[e[6]||(e[6]=_("h3",{class:"card-title"},"投资策略",-1)),x(F).value?(m(),h(i,{key:0,type:"primary",onClick:P},{default:l(()=>[t(C,null,{default:l(()=>[t(c)]),_:1}),e[4]||(e[4]=d(" 创建策略 ",-1))]),_:1})):(m(),h(H,{key:1,content:"只有分析师和管理员可以创建策略",placement:"top"},{default:l(()=>[t(i,{type:"primary",disabled:""},{default:l(()=>[t(C,null,{default:l(()=>[t(c)]),_:1}),e[5]||(e[5]=d(" 创建策略 ",-1))]),_:1})]),_:1}))])]),default:l(()=>[t(K,{data:u.value,style:{width:"100%"}},{default:l(()=>[t(v,{prop:"name",label:"策略名称",width:"200"}),t(v,{prop:"type",label:"类型",width:"120"},{default:l(({row:o})=>[t(J,{type:o.type==="builtin"?"success":"primary"},{default:l(()=>[d(R(o.type==="builtin"?"内置策略":"自定义策略"),1)]),_:2},1032,["type"])]),_:1}),t(v,{prop:"description",label:"策略描述"}),t(v,{prop:"createTime",label:"创建时间",width:"180"}),t(v,{label:"操作",width:"200"},{default:l(({row:o})=>[o.type!=="builtin"?(m(),h(i,{key:0,type:"primary",size:"small",disabled:!x($).value,title:x($).value?"编辑策略":"只有管理员可以编辑策略",onClick:g=>q(o)},{default:l(()=>[...e[7]||(e[7]=[d(" 编辑 ",-1)])]),_:1},8,["disabled","title","onClick"])):T("",!0),t(i,{type:"success",size:"small",onClick:g=>M(o)},{default:l(()=>[...e[8]||(e[8]=[d(" 回测 ",-1)])]),_:1},8,["onClick"]),x(F).value&&o.type!=="builtin"?(m(),h(i,{key:1,type:"danger",size:"small",onClick:g=>A(o)},{default:l(()=>[...e[9]||(e[9]=[d(" 删除 ",-1)])]),_:1},8,["onClick"])):T("",!0)]),_:1})]),_:1},8,["data"])]),_:1}),t(Y,{modelValue:w.value,"onUpdate:modelValue":e[3]||(e[3]=o=>w.value=o),title:V.value?"编辑策略":"创建策略",width:"800px",onClose:E},{footer:l(()=>[t(i,{onClick:e[2]||(e[2]=o=>w.value=!1)},{default:l(()=>[...e[11]||(e[11]=[d("取消",-1)])]),_:1}),t(i,{type:"primary",onClick:G,loading:S.value},{default:l(()=>[d(R(V.value?"更新":"创建"),1)]),_:1},8,["loading"])]),default:l(()=>[t(X,{model:a,rules:N,ref_key:"strategyFormRef",ref:y,"label-width":"120px"},{default:l(()=>[t(U,{label:"策略名称",prop:"name"},{default:l(()=>[t(D,{modelValue:a.name,"onUpdate:modelValue":e[0]||(e[0]=o=>a.name=o),placeholder:"请输入策略名称"},null,8,["modelValue"])]),_:1}),t(U,{label:"策略描述",prop:"description"},{default:l(()=>[t(D,{modelValue:a.description,"onUpdate:modelValue":e[1]||(e[1]=o=>a.description=o),type:"textarea",rows:3,placeholder:"请输入策略描述"},null,8,["modelValue"])]),_:1}),t(U,{label:"策略条件"},{default:l(()=>[_("div",ue,[(m(!0),B(ae,null,oe(a.conditions,(o,g)=>(m(),B("div",{key:g,class:"condition-item"},[t(I,{modelValue:o.indicator,"onUpdate:modelValue":f=>o.indicator=f,placeholder:"选择指标",style:{width:"150px"}},{default:l(()=>[t(r,{label:"PE市盈率",value:"pe"}),t(r,{label:"PB市净率",value:"pb"}),t(r,{label:"市值",value:"market_cap"}),t(r,{label:"成交量",value:"volume"}),t(r,{label:"涨跌幅",value:"change_percent"})]),_:1},8,["modelValue","onUpdate:modelValue"]),t(I,{modelValue:o.operator,"onUpdate:modelValue":f=>o.operator=f,placeholder:"条件",style:{width:"100px"}},{default:l(()=>[t(r,{label:"大于",value:">"}),t(r,{label:"小于",value:"<"}),t(r,{label:"等于",value:"="}),t(r,{label:"介于",value:"between"})]),_:1},8,["modelValue","onUpdate:modelValue"]),t(Q,{modelValue:o.value,"onUpdate:modelValue":f=>o.value=f,precision:2,placeholder:"值",style:{width:"120px"}},null,8,["modelValue","onUpdate:modelValue"]),t(i,{type:"danger",size:"small",onClick:f=>j(g)},{default:l(()=>[t(C,null,{default:l(()=>[t(W)]),_:1})]),_:1},8,["onClick"])]))),128)),t(i,{type:"dashed",onClick:L,style:{width:"100%"}},{default:l(()=>[t(C,null,{default:l(()=>[t(c)]),_:1}),e[10]||(e[10]=d(" 添加条件 ",-1))]),_:1})])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])])}}},fe=se(ce,[["__scopeId","data-v-ea903587"]]);export{fe as default};
